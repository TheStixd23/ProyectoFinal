using Photon.Pun;
using UnityEngine;
using System.Collections;

namespace Scrips
{
    [RequireComponent(typeof(Rigidbody2D))]
    public class Movement : MonoBehaviourPun
    {
        public float speed = 4f;
        public float mapClamp = 100f;

        Rigidbody2D rb;
        Camera cam;

        void Start() { rb = GetComponent<Rigidbody2D>(); cam = Camera.main; }

        void Update()
        {
            if (!photonView.IsMine) return;
            if (cam == null) cam = Camera.main;

            Vector3 m = cam.ScreenToWorldPoint(Input.mousePosition); m.z = 0f;
            Vector3 target = Vector3.MoveTowards(transform.position, m, speed * Time.deltaTime);
            target.x = Mathf.Clamp(target.x, -mapClamp, mapClamp);
            target.y = Mathf.Clamp(target.y, -mapClamp, mapClamp);
            rb.MovePosition(target);
        }

        [PunRPC]
        public void RPC_ApplySpeedBoost(float mult, float duration)
        {
            StopAllCoroutines();
            StartCoroutine(SpeedBoost(mult, duration));
        }

        IEnumerator SpeedBoost(float mult, float duration)
        {
            float original = speed;
            speed = original * mult;
            yield return new WaitForSeconds(duration);
            speed = original;
        }
    }
}